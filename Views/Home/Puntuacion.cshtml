@{
    ViewData["Title"] = "Desglose de Puntuación - Examen Práctico";
}

<div class="container mt-5">
    <h1 class="text-center mb-4">Desglose de Puntuación (50 pts)</h1>

    <div class="alert alert-info text-center fs-5 shadow-sm" id="puntuacion-total">
        Puntuación actual: <strong><span id="puntos">0</span> / 50 pts</strong>
    </div>

    <div class="card shadow-lg border-0">
        <div class="card-body">
            <p class="text-muted text-center mb-4">
                Marca con una casilla (✔) cada actividad completada.  
                La puntuación total se actualizará automáticamente.
            </p>

            <table class="table table-bordered table-striped align-middle">
                <thead class="table-dark">
                    <tr>
                        <th class="text-center" style="width: 50px;">✔</th>
                        <th>Actividad</th>
                        <th>Descripción</th>
                        <th class="text-center" style="width: 120px;">Puntos</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center">
                            <input type="checkbox" class="form-check-input checkbox-task" data-puntos="10" />
                        </td>
                        <td><strong>Configuración de la cadena de conexión</strong></td>
                        <td>Agregar correctamente el <code>ConnectionString</code> en <code>appsettings.json</code>.</td>
                        <td class="text-center">10 pts</td>
                    </tr>

                    <tr>
                        <td class="text-center">
                            <input type="checkbox" class="form-check-input checkbox-task" data-puntos="10" />
                        </td>
                        <td><strong>Configuración del contexto</strong></td>
                        <td>Registrar el <code>DbContext</code> en <code>Program.cs</code> usando <b>SQLite</b>.</td>
                        <td class="text-center">10 pts</td>
                    </tr>

                    <tr>
                        <td class="text-center">
                            <input type="checkbox" class="form-check-input checkbox-task" data-puntos="10" />
                        </td>
                        <td><strong>Creación de migraciones</strong></td>
                        <td>Crear e implementar correctamente las migraciones con <code>dotnet ef migrations add</code> y <code>dotnet ef database update</code>.</td>
                        <td class="text-center">10 pts</td>
                    </tr>

                    <tr>
                        <td class="text-center">
                            <input type="checkbox" class="form-check-input checkbox-task" data-puntos="15" />
                        </td>
                        <td><strong>Operaciones CRUD funcionales</strong></td>
                        <td>Mostrar, insertar, editar y eliminar registros desde la interfaz web sin errores.</td>
                        <td class="text-center">15 pts</td>
                    </tr>

                    <tr>
                        <td class="text-center">
                            <input type="checkbox" class="form-check-input checkbox-task" data-puntos="5" />
                        </td>
                        <td><strong>Prueba de ejecución</strong></td>
                        <td>El sistema se ejecuta sin errores y muestra los datos almacenados en la base de datos.</td>
                        <td class="text-center">5 pts</td>
                    </tr>
                </tbody>

                <tfoot class="table-light">
                    <tr>
                        <th colspan="3" class="text-end">Total</th>
                        <th class="text-center">50 pts</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <div class="text-center mt-4">
        <a asp-action="Index" asp-controller="Proveedores" class="btn btn-primary">
            <i class="bi bi-arrow-left-circle"></i> Volver al Sistema
        </a>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const checkboxes = document.querySelectorAll(".checkbox-task");
            const puntosEl = document.getElementById("puntos");

            function actualizarPuntuacion() {
                let total = 0;
                checkboxes.forEach((cb, i) => {
                    const key = "task_" + i;
                    if (cb.checked) {
                        total += parseInt(cb.dataset.puntos);
                        localStorage.setItem(key, "true");
                    } else {
                        localStorage.setItem(key, "false");
                    }
                });
                puntosEl.textContent = total;
            }

            // Cargar estado guardado
            checkboxes.forEach((cb, i) => {
                const key = "task_" + i;
                cb.checked = localStorage.getItem(key) === "true";
                cb.addEventListener("change", actualizarPuntuacion);
            });

            // Calcular al inicio
            actualizarPuntuacion();
        });
    </script>
}
